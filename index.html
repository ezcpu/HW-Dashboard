<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
<meta http-equiv="Pragma" content="no-cache"/>
<meta http-equiv="Expires" content="0"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes"/>

<title>Health & Wellness Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="css/styles.css"/>

<script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

</head>
<body>

<div class="header">
  <div class="dashboard-logo" style="display: flex; align-items: center; gap: 12px;">
  <svg width="48" height="48" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
    <circle cx="50" cy="50" r="48" fill="transparent" stroke="var(--border)" stroke-width="1" />
    <path d="M30 30V70M30 50H50" stroke="#3b82f6" stroke-width="8" stroke-linecap="round" />
    <path d="M50 30V70L65 55L80 70V30" fill="none" stroke="#8b5cf6" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" />
    <circle cx="65" cy="40" r="5" fill="#10b981" />
  </svg>
  <div style="line-height: 1;">
    <h1 style="background: none; -webkit-text-fill-color: unset; font-size: 28px; font-weight: 600; letter-spacing: -0.02em;">Health & Wellness Dashboard</h1>
  </div>
</div>
  <div class="header-controls">
    <select id="yearSelect" class="year-select" title="Filter by Year">
      <option value="all">All Years</option>
    </select>
    
    <button onclick="exportCSV()" class="btn-secondary" title="Download filtered data">
      ðŸ“¥ Export CSV
    </button>
    <button id="themeToggle" class="theme-toggle" aria-label="Toggle theme">ðŸŒ™ Dark Mode</button>
  </div>
</div>

<div class="status-bar">
  <div class="status-item">
    <span class="status-indicator" id="statusIndicator"></span>
    <span id="loadStatus">Initializing...</span>
  </div>
  <div class="status-item" id="lastUpdated" style="display:none;">
    <span>ðŸ“…</span><span id="lastUpdatedText">â€”</span>
  </div>
</div>

<div class="tabs" role="tablist">
  <button class="tab-button active" role="tab" aria-selected="true" onclick="openTab('current')">Overview</button>
  <button class="tab-button" role="tab" aria-selected="false" onclick="openTab('clubInsights')">Club Insights</button>
  <button class="tab-button" role="tab" aria-selected="false" onclick="openTab('employerPaid')">Employer-Sponsored</button>
  <button class="tab-button" role="tab" aria-selected="false" onclick="openTab('active')">Active Partners</button>
</div>

<div class="tab-content active" id="current" role="tabpanel">
  <div class="section">
    <div class="grid-4 kpis">
      <div class="kpi"><h3>Total Members</h3><div class="val" id="kpiTotal">â€”</div></div>
      <div class="kpi"><h3>Black Card</h3><div class="val" id="kpiBC">â€”</div></div>
      <div class="kpi"><h3>10NR Members</h3><div class="val" id="kpi10NR">â€”</div></div>
      <div class="kpi"><h3>Black Card Ratio</h3><div class="val" id="kpiRatio">â€”</div></div>
    </div>
  </div>

  <div class="section">
    <h3 class="section-title">Regional Distribution</h3>
    <div class="grid-3">
      <div class="card"><div class="legend">Total Members by Region</div><div id="regionTotalChart"></div></div>
      <div class="card"><div class="legend">Black Card by Region</div><div id="regionBCChart"></div></div>
      <div class="card"><div class="legend">10NR by Region</div><div id="region10NRChart"></div></div>
    </div>
  </div>

  <div class="section">
    <h3 class="section-title">Monthly Trends</h3>
    <div class="grid-2">
      <div class="card"><div class="legend">United States Signups</div><div id="impactUS"></div></div>
      <div class="card"><div class="legend">Canada Signups</div><div id="impactCAN"></div></div>
    </div>
  </div>

  <div class="section">
    <div class="card"><div class="legend">Top 5 Promotion Codes (US vs Canada)</div><div id="promoChart"></div></div>
  </div>
</div>

<div class="tab-content" id="clubInsights" role="tabpanel">
  <div class="card">
    <div class="toolbar">
      <div class="pill">
        <span>Club</span>
        <div class="dropdown-container">
          <button id="clubDropdownBtn" class="dropdown-trigger" onclick="toggleClubDropdown(event)">All Clubs</button>
          <div id="clubDropdownList" class="dropdown-menu">
            </div>
        </div>
      </div>

      <label class="pill">Month 
        <select id="monthSelect"><option value="all" selected>All Months</option></select>
      </label>
    </div>

    <div class="grid-4 kpis">
      <div class="kpi"><h3>Total Members</h3><div class="val" id="ckpiTotal">â€”</div></div>
      <div class="kpi"><h3>Black Card</h3><div class="val" id="ckpiBC">â€”</div></div>
      <div class="kpi"><h3>10NR Members</h3><div class="val" id="ckpi10NR">â€”</div></div>
      <div class="kpi"><h3>Black Card Ratio</h3><div class="val" id="ckpiRatio">â€”</div></div>
    </div>

    <div class="grid-2" style="margin-top:24px;">
      <div class="card"><div class="legend">Regional Split</div><div id="clubRegionDonut"></div></div>
      <div class="card"><div class="legend">Top Promotion Codes</div><div id="clubUsage"></div></div>
    </div>

    <div class="card" style="margin-top:24px;"><div class="legend">Monthly Signup Trend</div><div id="clubTrend"></div></div>
  </div>

  <div class="card" style="margin-top:24px;"><div class="legend">Top 5 Clubs by Usage (US vs Canada)</div><div id="topClubsChart"></div></div>
</div>

<div class="tab-content" id="employerPaid" role="tabpanel">
  <div class="card">
    <h3 class="section-title" style="margin-bottom:20px;">Employer-Sponsored Programs</h3>
    <table>
      <thead><tr><th>Company Name</th><th style="text-align:right;">Total Members</th></tr></thead>
      <tbody id="employerList">
        <tr><td colspan="2" style="text-align:center;color:var(--text-muted);padding:20px;">Loading data...</td></tr>
      </tbody>
    </table>
  </div>
</div>

<div class="tab-content" id="active" role="tabpanel">
  <div class="card">
    <div class="section-header">
      <h3 class="section-title">Active Partnership Network</h3>
      <div id="activeStatus" class="status-item"><span class="status-indicator"></span><span>Loading...</span></div>
    </div>

    <div class="grid-2" style="margin-bottom:24px;">
      <div class="card"><div class="legend">Geographic Distribution</div><div id="partnersByRegion"></div></div>
      <div class="card"><div class="legend">Payment Arrangement Types</div><div id="paymentByRegion"></div></div>
    </div>

    <div>
      <div class="legend" style="margin-bottom:16px;">Partner Directory</div>
      <ul id="partnersList" class="partners-list" style="max-height:600px;overflow-y:auto;"></ul>
    </div>
  </div>
</div>

<script src="js/theme.js"></script>
<script src="js/partners.js"></script>
<script src="js/data.js"></script>
<script src="js/charts.js"></script>
<script src="js/employer.js"></script>
<script src="js/main.js"></script>

</body>
</html>
